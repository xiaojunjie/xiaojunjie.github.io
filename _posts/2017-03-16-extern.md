---
layout: post
title: extern
categories: note
excerpt: extern int * data
tags: 计算机
---

{% highlight C++ %}
// main.c
void swap();
int data[] = {1,2};
int main() {
    swap();
    return 0;
}
// swap.c
extern int data[];
void swap() {
    int temp = data[0];
    data[0] = data[1];
    data[1] = temp;
}
// swap1.c
extern int * data
...
{% endhighlight %}
swap1出错，看下汇编  
{% highlight Python %}
//int data[]
movl	data, %eax
movl	data+4, %edx
movl	%eax, data+4
movl	%edx, data

//int * data
movl	data, %eax
movl	(%eax), %edx
movl	4(%eax), %ecx
movl	%edx, 4(%eax)
movl	%ecx, (%eax)
{% endhighlight %}
众所周知，"movl data, %eax" 是有访存滴，"movl $data, %eax"是把data值送到eax。  
简单点说，我的本意是要在swap1中引进data[0]指针 ,结果引进是data[0]    
发现 extern int * * * * * * * * * data引进的还是data[0]  
如果main中int a=1; swap中extern int * * * * * * * * * * a，输出的a还是1  
回到 extern int data，编译器是把data当成一个数据对象，并不会隐式转换成int指针，无论有没有加 *  
[stackoverflow](http://stackoverflow.com/questions/6385850/pointer-array-extern-question)
